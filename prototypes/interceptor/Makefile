# fins.mk contains the compiler and linker options for each target platform
include ../settings.finsmk

#This is the Module name. This MUST be that same as the current directory!!!
PROJECT_NAME = interceptor

#Additional includes for FINS core modules
CFLAGS += $(INTERCEPTOR_INC)

#add the names of any executables that are added to this directory here.  This
#ensures that they will be removed by clean
EXECUTABLES =  client_getsock client_loop3 client_loopback client_loopback1 client_loopback2 client_loopback3 client_Node client_Node_send client_recvmsg

#This is an autogenerated list of includes used in this project.
INCLUDES = $(foreach DIR_NAME, $(subst -I,, $(strip $(INTERCEPTOR_INC))), $(addprefix $(DIR_NAME)/, $(shell ls $(DIR_NAME)| grep \\.h)))




##### TARGETS #####
.PHONY:all
all:socket_interceptor.so $(EXECUTABLES)
	@echo "$(PROJECT_NAME) is compiled\n"

socket_interceptor.so:socket_interceptor.c $(INCLUDES)
	@$(CC) $(CFLAGS) -fPIC -c $<
	@$(LD) $(LDFLAGS) -shared -o $@ socket_interceptor.o

client_getsock:client_getsock.c $(INCLUDES)
	@$(CC) $(CFLAGS) $(INTERCEPTOR_INC) -c $< 
	@$(LD) $(LDFLAGS) $@.o -o $@ 

client_loop3:client_loop3.c $(INCLUDES)
	@$(CC) $(CFLAGS) $(INTERCEPTOR_INC) -c $< 
	@$(LD) $(LDFLAGS) $@.o -o $@

client_loopback:client_loopback.c $(INCLUDES)
	@$(CC) $(CFLAGS) $(INTERCEPTOR_INC) -c $< 
	@$(LD) $(LDFLAGS) $@.o -o $@

client_loopback1:client_loopback1.c $(INCLUDES) 
	@$(CC) $(CFLAGS) $(INTERCEPTOR_INC) -c $< 
	@$(LD) $(LDFLAGS) $@.o -o $@

client_loopback2:client_loopback2.c $(INCLUDES)
	@$(CC) $(CFLAGS) $(INTERCEPTOR_INC) -c $< 
	@$(LD) $(LDFLAGS) $@.o -o $@

client_loopback3:client_loopback3.c $(INCLUDES)
	@$(CC) $(CFLAGS) $(INTERCEPTOR_INC) -c $< 
	@$(LD) $(LDFLAGS) $@.o -o $@

client_Node:client_Node.c $(INCLUDES)
	@$(CC) $(CFLAGS) $(INTERCEPTOR_INC) -c $<
	@$(LD) $(LDFLAGS) $@.o -o $@

client_Node_send:client_Node_send.c $(INCLUDES)
	@$(CC) $(CFLAGS) $(INTERCEPTOR_INC) -c $< -o $@.o
	@$(LD) $(LDFLAGS) $@.o -o $@

client_recvmsg:client_recvmsg.c $(INCLUDES)
	@$(CC) $(CFLAGS) $(INTERCEPTOR_INC) -c $< 
	@$(LD) $(LDFLAGS) $@.o -o $@

.PHONY:clean
clean:
	@rm -f socket_interceptor.so
	@rm -f *.o 
	@rm -f $(EXECUTABLES) 
